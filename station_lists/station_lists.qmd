---
title: "station_lists"
---filter
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

```{r}
#| echo: false
#| 
#install.packages("sp")
library(harpIO)
library(sp)
library(here)
library(dplyr)
library(stringr)

```

```{r}
#| echo: false

source(here("data", "selections.R"))

monitor_station_list = function(station_list, this_list){
  if ("CBOX_ACTIVE" %in% names(this_list)){
    if (this_list$CBOX_ACTIVE){ 
      #sapply(this_list, function(x){print(x)})
      filter(station_list,
             (this_list$CBOX_WLON < lon & lon < this_list$CBOX_ELON) &
               (this_list$CBOX_SLAT < lat & lat < this_list$CBOX_NLAT)
      )
    }
  } else if ("LPOLY" %in% names(this_list)){
    if (this_list$LPOLY) {
      polygon <- read.table(
        here("data", this_list$POLYFILE), #
        skip = 1, 
        sep = "", 
        header = FALSE)
      filter(station_list,
             point.in.polygon(lon, lat, polygon$V2, polygon$V1) > 0
      )
    }
  } else if ("STNLIST" %in% names(this_list)){
    filter(station_list,
           (SID %in% this_list$STNLIST |
            this_list$STNLIST == 0))
  } 
}
#"master-location-identifier-database-202401_standard.csv"

master_list <- function(){
  read.table(
    "https://www.weathergraphics.com/identifiers/master-location-identifier-database-202507_standard.csv", 
    skip = 5, 
    sep = ",",
    quote= c('"',"'"),
    comment.char = "",
    header = TRUE)
  }
```

```{r}
  monitor_station_list(
    station_list,
    this_list = monitor_selections$Finland)

#csv <-  "master-location-identifier-database-202401_standard.csv"

master_list()|> filter(country == "Finland") -> buf
```

```{r}
fmisids <-  c("Uto",";59.784190;21.367637;100908",
              "Helsinki Kumpula",";60.203632;24.960721;101004",
"Helsinki Vantaa",";60.3267;24.95675;100968",
"Vantaa",";60.3267;24.95675;100968",
"Jokioinen",";60.81397222;23.49825;101104",
"Jyvaskyla",";62.39758473;25.67086659;101339",
"Kuopio",";62.892495;27.633796;101586",
"Sotkamo",";64.111972;28.336389;101756",
"Sodankyla",";67.36663;26.62901;101932",
"Utsjoki",";69.756241;27.006200;102035")

radstats <- master_list() %>%
  filter(sapply(station_name, function(x) any(str_detect(x, fmisids))))

```
